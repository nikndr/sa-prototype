<div class="sidebar">
  <div class="sidebar-header">
    <img src="assets/logo.png" alt="Shallow Swamp Logo" class="logo" />
    <h2>ShallowSwamp</h2>
  </div>

  <div class="sidebar-content">
    <button class="add-sensor-btn" (click)="showForm()" *ngIf="!isFormVisible">
      <span class="plus-icon">+</span>
      Add New Sensor
    </button>

    <div class="sensor-form" *ngIf="isFormVisible">
      <div class="form-header">
        <h3>Create New Sensor</h3>
        <button class="close-form-btn" (click)="hideForm()">&times;</button>
      </div>

      <form (ngSubmit)="onSubmit()">
        <div class="form-group">
          <label for="sensorName">Sensor Name</label>
          <input
            type="text"
            id="sensorName"
            [(ngModel)]="sensorName"
            name="sensorName"
            placeholder="Enter sensor name"
            required
          />
        </div>

        <div class="form-group">
          <label for="sensorType">Sensor Type</label>
          <select
            id="sensorType"
            [(ngModel)]="sensorType"
            name="sensorType"
            required
          >
            <option *ngFor="let type of sensorTypes" [value]="type">
              {{ type }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label>Position</label>
          <div class="position-info">
            <p class="instruction">Click on the map to drop a pin</p>
            <div *ngIf="selectedLat && selectedLng" class="coordinates">
              <strong>Selected Location:</strong>
              <span>Lat: {{ selectedLat.toFixed(6) }}</span>
              <span>Lng: {{ selectedLng.toFixed(6) }}</span>
            </div>
            <div *ngIf="!selectedLat || !selectedLng" class="no-position">
              No position selected yet
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="hideForm()">
            Cancel
          </button>
          <button type="submit" class="btn-primary">
            Create Sensor
          </button>
        </div>
      </form>
    </div>

    <div class="sensor-list" *ngIf="!isFormVisible">
      <h3>Existing Sensors ({{ sensors.length }})</h3>
      <div class="sensor-items">
        <div class="sensor-item" 
             *ngFor="let sensor of sensors" 
             (click)="selectSensor(sensor)"
             [class.selected]="selectedSensor?.id === sensor.id"
             [class.not-operational]="!sensor.isOperational">
          <div class="sensor-icon" 
               [style.background-color]="sensor.isOperational ? getSensorColor(sensor.type) : '#EF4444'"></div>
          <div class="sensor-info">
            <div class="sensor-name">
              {{ sensor.name }}
              <span class="not-operational-badge" *ngIf="!sensor.isOperational">Not Operational</span>
            </div>
            <div class="sensor-type" [class.text-red]="!sensor.isOperational">{{ sensor.type }}</div>
          </div>
        </div>
        <div class="empty-state" *ngIf="sensors.length === 0">
          No sensors yet. Add your first sensor!
        </div>
      </div>

      <!-- Selected Sensor Details -->
      <div class="sensor-details" *ngIf="selectedSensor">
        <div class="details-header">
          <h4>{{ selectedSensor.name }}</h4>
          <button class="close-details" (click)="clearSelection()">&times;</button>
        </div>
        <div class="details-content">
          <div class="detail-row">
            <span class="detail-label">Status:</span>
            <span class="detail-value" 
                  [class.status-operational]="selectedSensor.isOperational"
                  [class.status-not-operational]="!selectedSensor.isOperational">
              {{ selectedSensor.isOperational ? '✓ Operational' : '✗ Not Operational' }}
            </span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Type:</span>
            <span class="detail-value">{{ selectedSensor.type }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Current Value:</span>
            <span class="detail-value value-highlight">
              {{ formatSensorValue(selectedSensor) }}
            </span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Last Update:</span>
            <span class="detail-value">{{ getTimeSinceUpdate(selectedSensor.lastUpdate) }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Location:</span>
            <span class="detail-value location">
              {{ selectedSensor.lat.toFixed(4) }}, {{ selectedSensor.lng.toFixed(4) }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="sidebar-footer">
    <div class="version-info">
      <span class="version-label">Version</span>
      <span class="version-value">{{ appVersion }}</span>
    </div>
  </div>
</div>

